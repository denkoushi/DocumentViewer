# 2025-10-30 End-to-End Scan → Viewer 検証ログ

## 概要
- 目的: Window A (Pi4) から RaspberryPiServer (Pi5) へ `POST /api/v1/scans` を送信し、DocumentViewer が Socket.IO イベントで PDF を自動表示するまでの一連フローを確認する。
- 実施者: tools02
- 環境差異: 会社↔自宅の移動に伴い LAN セグメントが `192.168.10.x` から `192.168.128.x` へ変更。

## 手順と結果
1. **Pi5 のホスト名を固定**
   - `sudo hostnamectl set-hostname raspi-server`
   - 再起動後に `hostname -I` → `192.168.128.128` を確認。

2. **Pi4 の `/etc/hosts` を整理**
   - `sudo sed -i '/raspi-server.local/d' /etc/hosts`
   - `ping raspi-server.local` → 新しい IP に疎通できることを確認。

3. **REST API テスト**
   - `curl -s -X POST http://raspi-server.local:8501/api/v1/scans ...` を実行。
   - 結果: `HTTP 201` / `accepted: true`。

4. **Socket.IO リスナー**
   - `sudo docker compose exec -T app python /app/tests/socketio_listener.py` を起動。
   - `part_location_updated`, `scan_update` の両イベントを受信。

5. **DocumentViewer 表示確認**
   - Pi4 の `http://localhost:8501/viewer` で `testpart.pdf` が自動表示されることを確認。

## 所見
- LAN を跨ぐ場合は `/etc/hosts` に固定 IP を残さず、Pi5 のホスト名を `raspi-server` に統一する。
- `scripts/check_e2e_scan.sh` と `docs/checklists/daily-end-to-end.md` を利用することで日次確認が容易になった。

## TODO
- 日次チェックで `./scripts/check_e2e_scan.sh` を実行し、必要に応じて Socket.IO リスナー → Viewer 表示を確認するフローを RUNBOOK に組み込む。
