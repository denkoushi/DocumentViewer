# Document Viewer Requirements

## 背景と目的
- 金属加工工場で使用する部品別の作業要領書を、Raspberry Pi の表示端末で閲覧できるようにする。
- バーコード付き移動票をスキャンして該当部品の要領書を即時表示し、現場の作業効率と正確性を向上させる。

## ステークホルダー
- 現場オペレーター: 作業時に要領書を閲覧する。Excel で原稿を作成する。
- 生産管理担当者: 要領書テンプレートや更新手順を管理する。
- システム管理者 (想定): Raspberry Pi 端末を保守し、データの取り込みやアプリ更新を行う。

## 使用環境
- ハードウェア: Raspberry Pi 4 (4GB 以上推奨), USB バーコードハンディリーダ, USB マウス, フルHD モニター (1920x1080)。
- OS: Raspberry Pi OS 64bit。
- ネットワーク: 初期フェーズは単体運用 (オフライン)。
- 動作形態: 常時起動し、画面はフルスクリーン表示で固定。

## ドキュメント作成・更新フロー
1. 現場オペレーターが PC で提供された Excel テンプレートに従って作業要領書を作成・更新する。
2. 完成した Excel を PDF へエクスポート (ファイル名は部品番号そのものを使用)。
3. PDF を USB メモリーの指定フォルダへコピー。
4. USB メモリーを Raspberry Pi に接続。
5. Raspberry Pi 上のインポートツールが USB 内の PDF を確認し、
   - 同一部品番号のファイルが存在する場合は上書き更新、
   - 新規部品番号の場合は新規登録する。
6. インポート完了後、ビューワアプリをリロードまたは再起動して最新の PDF を参照可能にする。

> 運用支援: Excel テンプレートと PDF 書き出し手順、USB コピー手順をマニュアル化してオペレーターへ展開する。

## ビューワの基本操作フロー
1. ビューワアプリ起動で全画面表示。
2. 初期画面は待受状態。バーコード入力欄へ自動フォーカス。
3. 移動票のバーコードをスキャン (キーボードエミュレーション, Enter 送出想定)。
4. 内部ストレージの `documents/<部品番号>.pdf` を検索し、該当 PDF を表示。
5. マウス操作でページ送り (画面上の「前へ」「次へ」ボタン、またはスクロール)。
6. ESC などの特別操作は不要。一定時間操作が無い場合は待受画面へ戻る挙動を検討 (オプション)。

## 機能要件
- 部品番号入力
  - バーコードリーダからのキーボード入力を受け取り、Enter で検索を実行する。
  - 手入力対応 (ソフトキーボード/物理キーボード) は将来的な検討。
- ドキュメント検索・表示
  - ローカルフォルダに保管された PDF を部品番号で特定し表示する。
  - PDF 未登録の場合はエラーメッセージをフルスクリーンで表示し、一定時間後に待機画面へ戻る。
- ページ操作
  - マウスクリックでページ送り/戻し。
  - サムネイルやジャンプ機能は将来拡張とする。
- インポート
  - USB メモリ接続を検知し、指定フォルダ配下の PDF を `/home/pi/document-viewer/documents/` へコピーする。
  - コピー処理中は進捗を表示し、完了後に結果 (成功/エラー) を通知。
- 設定
  - 設定ファイル (例: `config.json`) でコピー先パス、待機タイムアウトなどを管理できるようにする。

## 非機能要件
- 性能: バーコードスキャンから 3 秒以内に該当 PDF の 1 ページ目を表示。
- 安定性: Raspberry Pi の常時稼働を想定し、OS 起動時に自動でビューワアプリが立ち上がる。
- 可用性: PDF が破損している場合はエラーログとユーザー通知を行う。
- 保守性: ドキュメントは部品番号=ファイル名の簡易ルールで管理。構造はフラット (サブフォルダ無し)。
- セキュリティ: 初期フェーズではアクセス制限は不要。将来的な拡張に備えて設計を分離しておく。

## ファイル構造案
```
/home/pi/document-viewer/
├── app/                  # ビューワアプリケーション
├── documents/            # 部品別 PDF 保管フォルダ (部品番号.pdf)
├── imports/              # USB から一時コピーする領域 (必要に応じて)
└── config.json           # パスやタイムアウトなどの設定
```

## 運用・メンテナンス
- 端末のバックアップ: 定期的に SD カードイメージをバックアップ。
- PDF 更新履歴: バージョン管理は手動 (Excel 原稿と PDF の履歴は PC 側で管理)。
- 定期点検: 月次で端末の状態、ストレージ空き容量、USB ポートを点検。
- 障害対応: 表示できない PDF がある場合は、PC 側原稿の再出力またはファイル破損の確認を実施。

## 将来課題・拡張余地
- PDF 以外の軽量フォーマット (HTML/画像) への移行検討。
- ネットワーク経由での自動同期、差分更新機能。
- バーコード以外の検索フォームや履歴表示。
- 操作ログ収集、閲覧統計の可視化。
- 多言語対応や音声指示などのアクセシビリティ拡張。

## オープン課題
- インポートツールの具体的な実装方式 (GUI/コマンドライン、手動実行か自動検知か)。
- 待受画面のデザインとロゴなどのブランド要素。
- PDF 表示ライブラリ選定 (Chromium kiosk, Electron, 独自ビューア)。
- オフライン環境での時刻同期・端末メンテナンス手順。

